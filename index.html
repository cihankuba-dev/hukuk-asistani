<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚öñÔ∏è Hukuk Asistanƒ±</title>
  <style>
    body { font-family: Arial, background:#f9f9f9; margin:0; padding:20px; }
    h1 { color:#1F3B73; text-align:center; }
    .box { background:#fff; padding:16px; margin:15px auto; border-radius:8px; max-width:700px; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    button { background:#1F3B73; color:#fff; padding:10px 14px; border:none; border-radius:6px; cursor:pointer; }
    button:hover { background:#304f9c; }
    textarea, input[type="file"], input[type="text"] { width:100%; margin-top:10px; padding:10px; }
    #output { white-space:pre-wrap; background:#eef; padding:14px; border-radius:6px; margin-top:10px; }
  </style>
</head>
<body>
  <h1>‚öñÔ∏è Hukuk Asistanƒ±</h1>

  <div class="box">
    <h2>üìÇ iCloud Klas√∂r√ºn√º Y√ºkle (√ñƒürenme)</h2>
    <input type="file" id="ingestInput" webkitdirectory directory multiple />
    <button onclick="ingest()">Klas√∂r√º Y√ºkle (Ingest)</button>
    <div id="ingestOut"></div>
  </div>

  <div class="box">
    <h2>üìú Serbest Dilek√ße</h2>
    <textarea id="petitionInput" rows="3" placeholder="√ñrn: Tutuklama itiraz dilek√ßesi hazƒ±rla"></textarea>
    <button onclick="createPetition()">Hazƒ±rla</button>
    <div id="petitionOut"></div>
  </div>

  <div class="box">
    <h2>üìÇ Belge Y√ºkle ‚Üí ‚öñÔ∏è Dilek√ße</h2>
    <input type="file" id="fileInput"/>
    <button onclick="draftFromFile()">Dilek√ße Olu≈ütur</button>
    <div id="draftOut"></div>
  </div>

  <div class="box">
    <h2>üîç Mevzuat & ƒ∞√ßtihat Ara</h2>
    <input type="text" id="lawQuery" placeholder="√ñrn: CMK 100 tutuklama"/>
    <button onclick="searchLaw()">Ara</button>
    <div id="lawOut"></div>
  </div>

  <div class="box">
    <h2>üìë Ar≈üivde Ara (RAG)</h2>
    <input type="text" id="ragQuery" placeholder="√ñrn: haksƒ±z tahrik, takdiri indirim"/>
    <button onclick="ragSearch()">Ar≈üivde Ara</button>
    <div id="ragOut"></div>
  </div>

  <script>
    const BASE_URL = "https://hukuk-asistani.onrender.com";

    async function ingest() {
      const files = document.getElementById("ingestInput").files;
      if (!files.length) return alert("Klas√∂r se√ß.");
      const form = new FormData();
      for (const f of files) form.append("files", f);
      const res = await fetch(`${BASE_URL}/ingest`, { method:"POST", body: form });
      const data = await res.json();
      document.getElementById("ingestOut").innerHTML = `<div id="output">${JSON.stringify(data,null,2)}</div>`;
    }

    async function createPetition() {
      const prompt = document.getElementById("petitionInput").value;
      if (!prompt) return alert("Ne t√ºr dilek√ße istediƒüini yaz.");
      const res = await fetch(`${BASE_URL}/petition`, { method:"POST", body: new URLSearchParams({ prompt }) });
      const data = await res.json();
      document.getElementById("petitionOut").innerHTML = `<div id="output">${data.draft}</div>`;
    }

    async function draftFromFile() {
      const f = document.getElementById("fileInput").files[0];
      if (!f) return alert("Bir dosya se√ß.");
      const form = new FormData();
      form.append("file", f);
      const res = await fetch(`${BASE_URL}/draft_from_file`, { method:"POST", body: form });
      const data = await res.json();
      document.getElementById("draftOut").innerHTML = `<div id="output">${data.draft}</div>`;
    }

    async function searchLaw() {
      const q = document.getElementById("lawQuery").value;
      if (!q) return alert("Sorgu yaz.");
      const res = await fetch(`${BASE_URL}/law_search?query=${encodeURIComponent(q)}`);
      const data = await res.json();
      document.getElementById("lawOut").innerHTML = `<div id="output">${data.results}</div>`;
    }

    async function ragSearch() {
      const q = document.getElementById("ragQuery").value;
      if (!q) return alert("Sorgu yaz.");
      const res = await fetch(`${BASE_URL}/search?q=${encodeURIComponent(q)}`);
      const data = await res.json();
      document.getElementById("ragOut").innerHTML = `<div id="output">${JSON.stringify(data.results,null,2)}</div>`;
    }
  </script>
</body>
</html>
